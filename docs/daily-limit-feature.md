# ğŸš€ AIå›¾ç‰‡ç”Ÿæˆæ¯æ—¥é™åˆ¶åŠŸèƒ½

## æ¦‚è¿°

æœ¬åŠŸèƒ½å®ç°äº†AIå›¾ç‰‡ç”Ÿæˆçš„æ¯æ—¥ä½¿ç”¨æ¬¡æ•°é™åˆ¶ï¼Œæœ‰æ•ˆæ§åˆ¶APIè°ƒç”¨æˆæœ¬ï¼ŒåŒæ—¶ä¸ºç”¨æˆ·æä¾›åˆç†çš„å…è´¹ä½¿ç”¨é¢åº¦ã€‚

## åŠŸèƒ½ç‰¹æ€§

### ğŸ“Š æ¯æ—¥é™åˆ¶é…ç½®
- **å…è´¹ç”¨æˆ·**: æ¯æ—¥50æ¬¡ç”Ÿæˆé™åˆ¶
- **VIPç”¨æˆ·**: æ¯æ—¥200æ¬¡ç”Ÿæˆé™åˆ¶  
- **ç®¡ç†å‘˜**: æ¯æ—¥1000æ¬¡ç”Ÿæˆé™åˆ¶

### â° è‡ªåŠ¨é‡ç½®æœºåˆ¶
- æ¯æ—¥0ç‚¹è‡ªåŠ¨é‡ç½®ä½¿ç”¨æ¬¡æ•°
- åŸºäºä½œå“åˆ›å»ºæ—¶é—´è¿›è¡Œç»Ÿè®¡
- åªç»Ÿè®¡æˆåŠŸç”Ÿæˆçš„ä½œå“ï¼Œå¤±è´¥çš„ä¸è®¡å…¥

### ğŸ”’ å¤šé‡ä¿æŠ¤æœºåˆ¶
- å‰ç«¯é¢„æ£€æŸ¥ï¼šç”Ÿæˆå‰æ£€æŸ¥å‰©ä½™æ¬¡æ•°
- åç«¯éªŒè¯ï¼šäº‘å‡½æ•°ä¸­è¿›è¡Œæœ€ç»ˆéªŒè¯
- å®æ—¶æ›´æ–°ï¼šç”Ÿæˆåç«‹å³æ›´æ–°ä½¿ç”¨ç»Ÿè®¡

## å®ç°æ¶æ„

### 1. äº‘å‡½æ•°å±‚é¢ (`miniprogram/cloudfunctions/aiGenerate/index.js`)

#### æ¯æ—¥é™åˆ¶é…ç½®
```javascript
const DAILY_LIMITS = {
  free: 50,     // å…è´¹ç”¨æˆ·æ¯æ—¥50æ¬¡
  vip: 200,     // VIPç”¨æˆ·æ¯æ—¥200æ¬¡
  admin: 1000   // ç®¡ç†å‘˜æ¯æ—¥1000æ¬¡
}
```

#### æ ¸å¿ƒæ£€æŸ¥å‡½æ•°
```javascript
// æ£€æŸ¥ä»Šæ—¥ç”Ÿæˆæ¬¡æ•°
async function checkDailyLimit(userId, userType) {
  const todayUsage = await getTodayUsageCount(userId)
  const dailyLimit = DAILY_LIMITS[userType]
  
  if (todayUsage >= dailyLimit) {
    throw new Error(`ä»Šæ—¥ç”Ÿæˆæ¬¡æ•°å·²è¾¾ä¸Šé™ï¼ˆ${dailyLimit}æ¬¡ï¼‰ï¼Œæ˜æ—¥0ç‚¹é‡ç½®`)
  }
  
  return {
    used: todayUsage,
    limit: dailyLimit,
    remaining: dailyLimit - todayUsage
  }
}
```

#### ä½¿ç”¨é‡ç»Ÿè®¡å‡½æ•°
```javascript
// è·å–ä»Šæ—¥ä½¿ç”¨æ¬¡æ•°
async function getTodayUsageCount(userId) {
  const today = new Date()
  const startOfDay = new Date(today.getFullYear(), today.getMonth(), today.getDate())
  const endOfDay = new Date(startOfDay.getTime() + 24 * 60 * 60 * 1000)
  
  const usageQuery = await db.collection('works')
    .where({
      userId: userId,
      status: db.command.neq('failed'), // ä¸è®¡ç®—å¤±è´¥çš„ç”Ÿæˆ
      createdAt: db.command.gte(startOfDay).and(db.command.lt(endOfDay))
    })
    .count()
  
  return usageQuery.total || 0
}
```

### 2. å‰ç«¯å±•ç¤ºå±‚é¢ (`miniprogram/pages/index/`)

#### æ•°æ®ç»“æ„
```javascript
data: {
  dailyUsage: {
    used: 0,        // ä»Šæ—¥å·²ä½¿ç”¨æ¬¡æ•°
    limit: 50,      // æ¯æ—¥é™åˆ¶æ¬¡æ•°
    remaining: 50,  // å‰©ä½™æ¬¡æ•°
    userType: 'free' // ç”¨æˆ·ç±»å‹
  }
}
```

#### å®æ—¶æ£€æŸ¥æœºåˆ¶
```javascript
// ç”Ÿæˆå‰æ£€æŸ¥
if (dailyUsage.remaining <= 0) {
  wx.showModal({
    title: 'ä»Šæ—¥ç”Ÿæˆæ¬¡æ•°å·²ç”¨å®Œ',
    content: `æ‚¨ä»Šæ—¥å·²ä½¿ç”¨ ${dailyUsage.used}/${dailyUsage.limit} æ¬¡ï¼Œæ˜æ—¥0ç‚¹é‡ç½®ã€‚å‡çº§VIPå¯è·å¾—æ›´å¤šæ¬¡æ•°ã€‚`,
    confirmText: 'å‡çº§VIP'
  })
  return
}
```

### 3. APIæ¥å£å±‚é¢

#### æ–°å¢äº‘å‡½æ•°Action
```javascript
case 'getDailyUsage':
  return await getDailyUsage(data, wxContext)
```

#### å‰ç«¯APIå°è£…
```javascript
// è·å–æ¯æ—¥ä½¿ç”¨é‡ç»Ÿè®¡
getDailyUsage() {
  const app = getApp()
  const userInfo = app.globalData.userInfo
  
  return callCloudFunction('aiGenerate', 'getDailyUsage', {
    userId: userInfo?.id
  })
}
```

## æ•°æ®æµç¨‹

### 1. é¡µé¢åŠ è½½æµç¨‹
```
ç”¨æˆ·æ‰“å¼€é¡µé¢ â†’ åˆå§‹åŒ–ç”¨æˆ·ä¿¡æ¯ â†’ åŠ è½½æ¯æ—¥ä½¿ç”¨é‡ â†’ æ˜¾ç¤ºç»Ÿè®¡ä¿¡æ¯
```

### 2. å›¾ç‰‡ç”Ÿæˆæµç¨‹
```
ç”¨æˆ·ç‚¹å‡»ç”Ÿæˆ â†’ å‰ç«¯æ£€æŸ¥å‰©ä½™æ¬¡æ•° â†’ è°ƒç”¨äº‘å‡½æ•° â†’ åç«¯å†æ¬¡éªŒè¯ â†’ ç”Ÿæˆå›¾ç‰‡ â†’ æ›´æ–°ä½¿ç”¨ç»Ÿè®¡
```

### 3. é”™è¯¯å¤„ç†æµç¨‹
```
è¶…å‡ºé™åˆ¶ â†’ æ˜¾ç¤ºé”™è¯¯æç¤º â†’ å¼•å¯¼å‡çº§VIP â†’ æä¾›æ˜æ—¥é‡ç½®è¯´æ˜
```

## ç”¨æˆ·ä½“éªŒä¼˜åŒ–

### ğŸ“± ç•Œé¢æ˜¾ç¤º
- æ˜¾ç¤ºä»Šæ—¥ä½¿ç”¨æ¬¡æ•°ï¼š`æ¯æ—¥é™åˆ¶ï¼š15/50æ¬¡ (å…è´¹ç”¨æˆ·)`
- å®æ—¶æ›´æ–°å‰©ä½™æ¬¡æ•°
- ç”¨æˆ·ç±»å‹æ ‡è¯†ï¼ˆå…è´¹/VIPï¼‰

### ğŸ’¬ å‹å¥½æç¤º
- è¶…å‡ºé™åˆ¶æ—¶çš„è¯¦ç»†è¯´æ˜
- é‡ç½®æ—¶é—´æç¤ºï¼ˆæ˜æ—¥0ç‚¹ï¼‰
- VIPå‡çº§å¼•å¯¼

### ğŸ”„ è‡ªåŠ¨åˆ·æ–°
- ç”ŸæˆæˆåŠŸåè‡ªåŠ¨æ›´æ–°ç»Ÿè®¡
- é¡µé¢é‡æ–°åŠ è½½æ—¶åˆ·æ–°æ•°æ®
- æ”¯æŒå®æ—¶æŸ¥è¯¢å½“å‰çŠ¶æ€

## éƒ¨ç½²è¯´æ˜

### 1. äº‘å‡½æ•°éƒ¨ç½²
```bash
# åœ¨å¾®ä¿¡å¼€å‘è€…å·¥å…·ä¸­
å³é”® cloudfunctions/aiGenerate â†’ åˆ›å»ºå¹¶éƒ¨ç½²ï¼šäº‘ç«¯å®‰è£…ä¾èµ–
```

### 2. å‰ç«¯æ›´æ–°
æ‰€æœ‰å‰ç«¯æ–‡ä»¶ä¿®æ”¹å®Œæˆï¼Œç›´æ¥ç¼–è¯‘é¢„è§ˆå³å¯ç”Ÿæ•ˆ

### 3. æ•°æ®åº“è¦æ±‚
- ç¡®ä¿ `works` é›†åˆå­˜åœ¨
- ç¡®ä¿ `users` é›†åˆåŒ…å« `vipLevel` å­—æ®µ
- ç¡®ä¿ä½œå“è®°å½•åŒ…å« `status` å’Œ `createdAt` å­—æ®µ

## ç›‘æ§ä¸ç»´æŠ¤

### ğŸ“ˆ ä½¿ç”¨ç»Ÿè®¡
- å¯é€šè¿‡ `getDailyUsage` API å®æ—¶æŸ¥è¯¢
- æ”¯æŒæŒ‰ç”¨æˆ·ç±»å‹åˆ†ç»„ç»Ÿè®¡
- å¯æ‰©å±•ä¸ºç®¡ç†åå°æ•°æ®æº

### ğŸ”§ é…ç½®è°ƒæ•´
```javascript
// è°ƒæ•´æ¯æ—¥é™åˆ¶åªéœ€ä¿®æ”¹æ­¤é…ç½®
const DAILY_LIMITS = {
  free: 50,     // å¯æ ¹æ®éœ€è¦è°ƒæ•´
  vip: 200,     // å¯æ ¹æ®éœ€è¦è°ƒæ•´
  admin: 1000   // å¯æ ¹æ®éœ€è¦è°ƒæ•´
}
```

### ğŸ› ï¸ æ•…éšœæ’é™¤
- æ£€æŸ¥äº‘å‡½æ•°éƒ¨ç½²çŠ¶æ€
- éªŒè¯æ•°æ®åº“æƒé™é…ç½®
- æŸ¥çœ‹äº‘å‡½æ•°æ—¥å¿—è¾“å‡º
- ç¡®è®¤æ—¶é—´è®¡ç®—å‡†ç¡®æ€§

## æ‰©å±•åŠŸèƒ½

### ğŸ¯ æœªæ¥å¯æ‰©å±•ç‰¹æ€§
1. **æŒ‰å°æ—¶é™åˆ¶**: é˜²æ­¢çŸ­æ—¶é—´å†…å¤§é‡è°ƒç”¨
2. **åŠ¨æ€é™åˆ¶**: æ ¹æ®APIæˆæœ¬åŠ¨æ€è°ƒæ•´
3. **ç”¨æˆ·ç­‰çº§**: æ›´ç»†ç²’åº¦çš„ç”¨æˆ·åˆ†çº§
4. **ä½¿ç”¨åˆ†æ**: è¯¦ç»†çš„ä½¿ç”¨æ•°æ®åˆ†æ

### ğŸ”„ å…¼å®¹æ€§
- å‘ä¸‹å…¼å®¹ç°æœ‰ç§¯åˆ†ç³»ç»Ÿ
- æ”¯æŒç°æœ‰VIPæœºåˆ¶
- å¯é…åˆå…¶ä»–é™åˆ¶ç­–ç•¥ä½¿ç”¨

---

## æ€»ç»“

è¯¥æ¯æ—¥é™åˆ¶åŠŸèƒ½æˆåŠŸå®ç°äº†ï¼š
âœ… æ¯æ—¥50æ¬¡çš„ç”Ÿæˆé™åˆ¶ï¼ˆå…è´¹ç”¨æˆ·ï¼‰
âœ… 0ç‚¹è‡ªåŠ¨é‡ç½®æœºåˆ¶  
âœ… VIPç”¨æˆ·æ›´é«˜é™åˆ¶
âœ… å‹å¥½çš„ç”¨æˆ·æç¤º
âœ… å®æ—¶ç»Ÿè®¡æ›´æ–°
âœ… å®Œå–„çš„é”™è¯¯å¤„ç†

æœ‰æ•ˆæ§åˆ¶äº†APIè°ƒç”¨æˆæœ¬ï¼ŒåŒæ—¶ä¿è¯äº†è‰¯å¥½çš„ç”¨æˆ·ä½“éªŒã€‚ 