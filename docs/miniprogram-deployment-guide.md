# 微信小程序发布完整指南

## 项目现状

✅ **后端API服务** - 100%完成
- Node.js Express服务器已搭建
- SQLite数据库正常运行
- DeepSeek AI集成完成
- 所有API接口测试通过

✅ **前端小程序** - 基本完成
- 原生微信小程序结构完整
- 主要页面已开发完成
- API对接已完成

## 1. 前置准备

### 1.1 注册微信小程序账号
1. 访问 [微信公众平台](https://mp.weixin.qq.com/)
2. 点击"立即注册" → 选择"小程序"
3. 填写账户信息并完成邮箱验证
4. 完成主体信息登记（个人/企业）
5. 获取 AppID（在"开发" → "开发管理" → "开发设置"中查看）

### 1.2 安装微信开发者工具
1. 下载 [微信开发者工具](https://developers.weixin.qq.com/miniprogram/dev/devtools/download.html)
2. 安装并启动工具
3. 使用微信扫码登录

## 2. 项目配置

### 2.1 更新项目配置
编辑 `miniprogram/project.config.json`，将 AppID 替换为你的真实 AppID：

```json
{
  "appid": "你的AppID",
  "projectname": "ai-image-generator"
}
```

### 2.2 配置服务器域名
在微信公众平台后台：
1. 进入"开发" → "开发管理" → "开发设置"
2. 在"服务器域名"中配置：
   - request合法域名：添加你的后端服务器域名
   - 开发阶段可以在开发者工具中关闭域名校验

### 2.3 更新API地址
编辑 `miniprogram/utils/api.js`，更新生产环境API地址：

```javascript
const API_BASE_URL = 'https://your-domain.com/api'  // 替换为你的服务器地址
```

## 3. 后端部署

### 3.1 服务器部署选项

#### 选项1：腾讯云云函数（推荐）
```bash
# 已配置serverless.yml，可直接部署
cd ai-backend
npm install -g serverless
serverless deploy
```

#### 选项2：阿里云/腾讯云服务器
```bash
# 1. 购买云服务器
# 2. 安装Node.js 18+
# 3. 上传代码
# 4. 安装依赖
npm install
# 5. 启动服务
npm start
```

#### 选项3：Vercel（免费）
```bash
# 1. 安装Vercel CLI
npm install -g vercel
# 2. 在ai-backend目录部署
cd ai-backend
vercel
```

### 3.2 数据库配置
- SQLite数据库文件会自动创建
- 确保服务器有写入权限
- 生产环境建议定期备份database文件

## 4. 小程序开发与测试

### 4.1 导入项目
1. 打开微信开发者工具
2. 选择"导入项目"
3. 项目目录选择：`/path/to/your/project/miniprogram`
4. 输入AppID和项目名称
5. 点击"导入"

### 4.2 本地测试
1. 确保后端服务正在运行（localhost:3000）
2. 在开发者工具中点击"编译"
3. 测试主要功能：
   - 用户登录
   - 文字输入
   - AI生成提示词
   - 结果展示

### 4.3 真机测试
1. 点击开发者工具右上角"预览"
2. 使用微信扫描二维码
3. 在真机上测试完整流程

## 5. 小程序发布

### 5.1 代码上传
1. 在开发者工具中点击"上传"
2. 填写版本号和项目备注
3. 点击"上传"确认

### 5.2 提交审核
1. 登录微信公众平台
2. 进入"版本管理"
3. 找到刚上传的版本，点击"提交审核"
4. 填写版本描述和功能介绍
5. 提交等待审核（通常1-7个工作日）

### 5.3 发布上线
1. 审核通过后，在"版本管理"中点击"发布"
2. 确认发布，小程序正式上线

## 6. 运营配置

### 6.1 小程序信息完善
在微信公众平台配置：
- 小程序头像和昵称
- 服务类别
- 简介和功能介绍
- 客服设置

### 6.2 搜索优化
- 配置品牌词和功能词
- 完善小程序描述
- 添加相关标签

## 7. 监控与维护

### 7.1 数据监控
- 使用微信小程序数据助手
- 监控用户访问、留存等数据
- 关注错误日志和性能指标

### 7.2 版本更新
- 定期更新小程序版本
- 修复用户反馈的问题
- 添加新功能

## 8. 成本预估

### 8.1 免费方案
- **小程序账号**：个人免费
- **服务器**：Vercel免费额度
- **AI服务**：DeepSeek免费额度
- **总成本**：0元/月

### 8.2 付费方案
- **小程序认证**：300元/年（可选）
- **云服务器**：100-500元/月
- **AI服务**：按使用量计费
- **总成本**：100-800元/月

## 9. 常见问题

### Q1: 小程序无法访问本地服务器？
A: 需要配置合法域名，开发阶段可关闭域名校验

### Q2: AI生成失败？
A: 检查DeepSeek API密钥是否正确配置

### Q3: 数据库连接失败？
A: 确保SQLite文件有读写权限

### Q4: 审核被拒？
A: 检查是否涉及敏感内容，完善用户协议和隐私政策

## 10. 技术支持

如遇到问题，可以：
1. 查看微信小程序官方文档
2. 检查控制台错误日志
3. 联系微信客服

---

**恭喜！** 按照以上步骤，你的AI绘图小程序就可以成功发布了！🎉 