# 🚨 体验版白屏问题修复指南

## 🔍 问题诊断

体验版首页显示白屏，主要原因可能有：

### 1. ❌ 云环境ID不匹配
**问题**：`app.js` 中的云环境ID与实际环境不一致
- 旧ID：`text-to-images-mp-9ekbr0131f377e`
- 正确ID：`cloud1-7gndy7e31d73bb76`

**修复状态**：✅ 已修复

### 2. 🔄 云函数未部署或失败
**问题**：登录云函数调用失败导致页面无法正常初始化

### 3. 📱 权限配置问题
**问题**：小程序权限配置不正确

## 🛠️ 立即修复步骤

### 第1步：重新上传代码
```
1. 在微信开发者工具中点击"上传"
2. 版本号：1.0.1（修复版本）
3. 备注：修复白屏问题 - 云环境ID配置
```

### 第2步：检查云函数部署状态

在微信开发者工具中：

1. **检查云函数列表**：
   ```
   右侧云开发面板 → 云函数 → 检查以下函数是否存在：
   - login ✓
   - aiGenerate ✓ 
   - userInfo ✓
   - workManage ✓
   ```

2. **重新部署云函数**（如果有问题）：
   ```
   右键每个云函数 → 重新上传并部署：云端安装依赖
   ```

### 第3步：清除缓存并测试

1. **清除小程序缓存**：
   ```
   开发者工具 → 项目 → 清缓存 → 全部清除
   ```

2. **重新预览**：
   ```
   点击"预览" → 扫码测试体验版
   ```

## 🔧 代码修复详情

### app.js 修复内容：

```javascript
// 修复前
env: 'text-to-images-mp-9ekbr0131f377e'

// 修复后  
env: 'cloud1-7gndy7e31d73bb76'
```

### 增加容错处理：

```javascript
// 即使登录失败也不阻塞页面加载
this.globalData.userInfo = {
  id: 'temp_user',
  nickname: '临时用户', 
  credits: 10,
  userType: 'guest'
}
```

## ⚠️ 紧急调试方法

### 方法1：真机调试
```
1. 开发者工具 → 远程调试
2. 手机微信扫码
3. 查看控制台错误信息
```

### 方法2：vconsole调试
在 `app.js` 中临时添加：
```javascript
// 在 onLaunch 开头添加
if (typeof VConsole !== 'undefined') {
  new VConsole()
}
```

### 方法3：简化页面测试
临时简化 `pages/index/index.js`：
```javascript
Page({
  data: {
    inputText: '',
    remainingCount: 10,
    isGenerating: false
  },
  
  onLoad() {
    console.log('页面加载成功')
    wx.showToast({
      title: '页面加载成功',
      icon: 'success'
    })
  }
})
```

## 📋 检查清单

### ✅ 环境配置检查
- [ ] 云环境ID正确：`cloud1-7gndy7e31d73bb76`
- [ ] 云函数全部部署成功
- [ ] 数据库集合存在：users, works, creditLogs
- [ ] 小程序权限配置正确

### ✅ 功能测试检查  
- [ ] 页面能正常显示
- [ ] 输入框可以输入文字
- [ ] 生成按钮可以点击
- [ ] 用户信息正常显示

### ✅ 日志检查
- [ ] 控制台无致命错误
- [ ] 云函数调用成功
- [ ] 网络请求正常

## 🚀 快速恢复步骤

### 1分钟快速修复：
```bash
1. 开发者工具重新上传代码（版本1.0.1）
2. 清除缓存
3. 重新预览测试
```

### 5分钟深度修复：
```bash
1. 检查并重新部署所有云函数
2. 验证数据库集合存在
3. 检查权限配置
4. 真机调试验证
```

## 📞 如果仍然白屏

请检查以下信息并反馈：

1. **错误信息**：开发者工具控制台的具体错误
2. **网络状态**：是否能正常访问网络
3. **基础库版本**：微信开发者工具设置中的基础库版本
4. **真机测试**：在真实手机上的表现

---

## 🎯 预期结果

修复后，体验版应该能正常显示：
- ✅ 输入文字区域
- ✅ "开始创作配图" 按钮  
- ✅ "今日剩余生成次数" 显示
- ✅ 页面交互正常

立即执行修复步骤，问题应该能快速解决！ 