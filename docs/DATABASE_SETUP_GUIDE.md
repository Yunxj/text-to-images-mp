
# äº‘å¼€å‘æ•°æ®åº“é›†åˆå¿«é€Ÿåˆ›å»ºæŒ‡å—

## ğŸ¯ éœ€è¦åˆ›å»ºçš„é›†åˆ

æ€»å…±éœ€è¦åˆ›å»º **3ä¸ªé›†åˆ**ï¼š


### users - ç”¨æˆ·ä¿¡æ¯é›†åˆ
**æƒé™é…ç½®**ï¼š
```json
{
  "read": true,
  "write": "doc._openid == auth.openid"
}
```

**ç¤ºä¾‹æ•°æ®**ï¼š
```json
{
  "_openid": "test_user_123",
  "nickname": "æµ‹è¯•ç”¨æˆ·",
  "avatar": "https://example.com/avatar.jpg",
  "credits": 100,
  "totalGenerated": 0,
  "membership": "free",
  "createdAt": "2025-06-24T08:13:59.481Z",
  "updatedAt": "2025-06-24T08:13:59.481Z"
}
```

**ç´¢å¼•é…ç½®**ï¼š

- **openid_index**ï¼š
  ```json
  {
  "_openid": 1
}
  ```



### works - ç”¨æˆ·ä½œå“é›†åˆ
**æƒé™é…ç½®**ï¼š
```json
{
  "read": true,
  "write": "doc.userId == auth.openid"
}
```

**ç¤ºä¾‹æ•°æ®**ï¼š
```json
{
  "userId": "test_user_123",
  "title": "æµ‹è¯•ä½œå“",
  "prompt": "ä¸€åªå¯çˆ±çš„å°çŒ«",
  "imageUrl": "https://example.com/image.jpg",
  "model": "cogview-3",
  "style": "realistic",
  "isPublic": false,
  "isFavorite": true,
  "tags": [
    "åŠ¨ç‰©",
    "å¯çˆ±"
  ],
  "createdAt": "2025-06-24T08:13:59.481Z",
  "updatedAt": "2025-06-24T08:13:59.481Z"
}
```

**ç´¢å¼•é…ç½®**ï¼š

- **user_time_index**ï¼š
  ```json
  {
  "userId": 1,
  "createdAt": -1
}
  ```

- **public_time_index**ï¼š
  ```json
  {
  "isPublic": 1,
  "createdAt": -1
}
  ```



### creditLogs - ç§¯åˆ†è®°å½•é›†åˆ
**æƒé™é…ç½®**ï¼š
```json
{
  "read": "doc.userId == auth.openid",
  "write": "doc.userId == auth.openid"
}
```

**ç¤ºä¾‹æ•°æ®**ï¼š
```json
{
  "userId": "test_user_123",
  "type": "consume",
  "amount": -10,
  "reason": "ç”Ÿæˆå›¾ç‰‡",
  "description": "ä½¿ç”¨AIç”Ÿæˆå›¾ç‰‡æ¶ˆè€—ç§¯åˆ†",
  "relatedId": "work_123",
  "balance": 90,
  "createdAt": "2025-06-24T08:13:59.481Z"
}
```

**ç´¢å¼•é…ç½®**ï¼š

- **user_time_index**ï¼š
  ```json
  {
  "userId": 1,
  "createdAt": -1
}
  ```



## ğŸš€ å¿«é€Ÿåˆ›å»ºæ­¥éª¤

### æ­¥éª¤1ï¼šæ‰“å¼€äº‘å¼€å‘æ§åˆ¶å°
1. åœ¨å¾®ä¿¡å¼€å‘è€…å·¥å…·ä¸­ç‚¹å‡»"äº‘å¼€å‘"æŒ‰é’®
2. æˆ–ç›´æ¥è®¿é—®ï¼šhttps://console.cloud.tencent.com/tcb

### æ­¥éª¤2ï¼šæ‰¹é‡åˆ›å»ºé›†åˆ
ä¾æ¬¡åˆ›å»ºä»¥ä¸‹é›†åˆï¼š

#### åˆ›å»º users é›†åˆ
1. ç‚¹å‡»"æ–°å»ºé›†åˆ" â†’ è¾“å…¥ `users` â†’ ç¡®å®š
2. è¿›å…¥ users é›†åˆ â†’ æƒé™è®¾ç½® â†’ è‡ªå®šä¹‰å®‰å…¨è§„åˆ™
3. å¤åˆ¶ç²˜è´´æƒé™é…ç½®ï¼ˆè§ä¸Šæ–¹ï¼‰

#### åˆ›å»º works é›†åˆ  
1. ç‚¹å‡»"æ–°å»ºé›†åˆ" â†’ è¾“å…¥ `works` â†’ ç¡®å®š
2. è¿›å…¥ works é›†åˆ â†’ æƒé™è®¾ç½® â†’ è‡ªå®šä¹‰å®‰å…¨è§„åˆ™
3. å¤åˆ¶ç²˜è´´æƒé™é…ç½®ï¼ˆè§ä¸Šæ–¹ï¼‰

#### åˆ›å»º creditLogs é›†åˆ
1. ç‚¹å‡»"æ–°å»ºé›†åˆ" â†’ è¾“å…¥ `creditLogs` â†’ ç¡®å®š
2. è¿›å…¥ creditLogs é›†åˆ â†’ æƒé™è®¾ç½® â†’ è‡ªå®šä¹‰å®‰å…¨è§„åˆ™
3. å¤åˆ¶ç²˜è´´æƒé™é…ç½®ï¼ˆè§ä¸Šæ–¹ï¼‰

### æ­¥éª¤3ï¼šåˆ›å»ºç´¢å¼•ï¼ˆå¯é€‰ï¼Œä¼˜åŒ–æ€§èƒ½ï¼‰
å¯¹æ¯ä¸ªé›†åˆåˆ›å»ºå¯¹åº”çš„ç´¢å¼•ï¼ˆå‚è€ƒä¸Šæ–¹ç´¢å¼•é…ç½®ï¼‰

### æ­¥éª¤4ï¼šæ·»åŠ æµ‹è¯•æ•°æ®ï¼ˆå¯é€‰ï¼‰
åœ¨æ¯ä¸ªé›†åˆä¸­æ·»åŠ ä¸€æ¡æµ‹è¯•æ•°æ®ï¼ˆå‚è€ƒä¸Šæ–¹ç¤ºä¾‹æ•°æ®ï¼‰

## âœ… éªŒè¯åˆ›å»ºç»“æœ

åˆ›å»ºå®Œæˆåï¼Œæ•°æ®åº“é¡µé¢åº”æ˜¾ç¤ºï¼š
- âœ… users (0æ¡è®°å½•)
- âœ… works (0æ¡è®°å½•)  
- âœ… creditLogs (0æ¡è®°å½•)

## ğŸ”§ è‡ªåŠ¨åŒ–åˆ›å»ºï¼ˆé«˜çº§ï¼‰

å¦‚æœæ‚¨ç†Ÿæ‚‰äº‘å¼€å‘SDKï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹ä»£ç æ‰¹é‡åˆ›å»ºï¼š

```javascript
// æ³¨æ„ï¼šæ­¤ä»£ç éœ€è¦åœ¨äº‘å‡½æ•°ä¸­è¿è¡Œ
const cloud = require('wx-server-sdk');
cloud.init();
const db = cloud.database();

async function initDatabase() {
  try {
    // åˆ›å»ºé›†åˆï¼ˆå¦‚æœä¸å­˜åœ¨ä¼šè‡ªåŠ¨åˆ›å»ºï¼‰
    await db.collection('users').get();
    await db.collection('works').get();
    await db.collection('creditLogs').get();
    
    console.log('æ•°æ®åº“é›†åˆåˆå§‹åŒ–å®Œæˆ');
  } catch (error) {
    console.log('é›†åˆåˆ›å»ºå®Œæˆ');
  }
}
```

---
ç”Ÿæˆæ—¶é—´ï¼š2025/6/24 16:13:59
